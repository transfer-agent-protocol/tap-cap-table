# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Costly operations inside loop](#l-2-costly-operations-inside-loop)
  - [L-3: Loop Contains `require`/`revert`](#l-3-loop-contains-requirerevert)
  - [L-4: State Change Without Event](#l-4-state-change-without-event)
  - [L-5: Unchecked Return](#l-5-unchecked-return)
  - [L-6: Unused Error](#l-6-unused-error)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 4 |
| Total nSLOC | 526 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/CapTable.sol | 426 |
| src/CapTableFactory.sol | 34 |
| src/interfaces/ICapTable.sol | 58 |
| src/interfaces/ICapTableFactory.sol | 8 |
| **Total** | **526** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 0 |
| Low | 6 |


# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>3 Found Instances</summary>


- Found in src/CapTableFactory.sol [Line: 10](chain/src/CapTableFactory.sol#L10)

	```solidity
	contract CapTableFactory is ICapTableFactory, Ownable {
	```

- Found in src/CapTableFactory.sol [Line: 21](chain/src/CapTableFactory.sol#L21)

	```solidity
	    function createCapTable(bytes16 id, string memory name, uint256 initial_shares_authorized) external onlyOwner returns (address) {
	```

- Found in src/CapTableFactory.sol [Line: 33](chain/src/CapTableFactory.sol#L33)

	```solidity
	    function updateCapTableImplementation(address newImplementation) external onlyOwner {
	```

</details>



## L-2: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>2 Found Instances</summary>


- Found in src/CapTable.sol [Line: 109](chain/src/CapTable.sol#L109)

	```solidity
	        for (uint256 i = 0; i < params.stockClassesInitialShares.length; i++) {
	```

- Found in src/CapTable.sol [Line: 137](chain/src/CapTable.sol#L137)

	```solidity
	        for (uint256 i = 0; i < stakeholderIds.length; i++) {
	```

</details>



## L-3: Loop Contains `require`/`revert`

Avoid `require` / `revert` statements in a loop because a single bad item can cause the whole transaction to fail. It's better to forgive on fail and return failed elements post processing of the loop

<details><summary>2 Found Instances</summary>


- Found in src/CapTable.sol [Line: 109](chain/src/CapTable.sol#L109)

	```solidity
	        for (uint256 i = 0; i < params.stockClassesInitialShares.length; i++) {
	```

- Found in src/CapTable.sol [Line: 137](chain/src/CapTable.sol#L137)

	```solidity
	        for (uint256 i = 0; i < stakeholderIds.length; i++) {
	```

</details>



## L-4: State Change Without Event

There are state variable changes in this function but no event is emitted. Consider emitting an event to enable offchain indexers to track the changes.

<details><summary>14 Found Instances</summary>


- Found in src/CapTable.sol [Line: 98](chain/src/CapTable.sol#L98)

	```solidity
	    function seedSharesAuthorizedAndIssued(InitialShares calldata params) external override {
	```

- Found in src/CapTable.sol [Line: 120](chain/src/CapTable.sol#L120)

	```solidity
	    function seedMultipleActivePositionsAndSecurityIds(
	```

- Found in src/CapTable.sol [Line: 187](chain/src/CapTable.sol#L187)

	```solidity
	    function createStockLegendTemplate(bytes16 _id) external override onlyAdmin {
	```

- Found in src/CapTable.sol [Line: 194](chain/src/CapTable.sol#L194)

	```solidity
	    function addWalletToStakeholder(bytes16 _stakeholder_id, address _wallet) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 204](chain/src/CapTable.sol#L204)

	```solidity
	    function removeWalletFromStakeholder(bytes16 _stakeholder_id, address _wallet) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 212](chain/src/CapTable.sol#L212)

	```solidity
	    function issueStock(StockIssuanceParams calldata params) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 227](chain/src/CapTable.sol#L227)

	```solidity
	    function repurchaseStock(StockParams calldata params, uint256 quantity, uint256 price) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 255](chain/src/CapTable.sol#L255)

	```solidity
	    function retractStockIssuance(StockParams calldata params) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 273](chain/src/CapTable.sol#L273)

	```solidity
	    function reissueStock(StockParams calldata params, bytes16[] memory resulting_security_ids) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 293](chain/src/CapTable.sol#L293)

	```solidity
	    function cancelStock(StockParams calldata params, uint256 quantity) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 320](chain/src/CapTable.sol#L320)

	```solidity
	    function transferStock(StockTransferParams calldata params) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 350](chain/src/CapTable.sol#L350)

	```solidity
	    function acceptStock(bytes16 stakeholderId, bytes16 stockClassId, bytes16 securityId, string[] memory comments) external override onlyOperator {
	```

- Found in src/CapTable.sol [Line: 364](chain/src/CapTable.sol#L364)

	```solidity
	    function adjustIssuerAuthorizedShares(
	```

- Found in src/CapTable.sol [Line: 386](chain/src/CapTable.sol#L386)

	```solidity
	    function adjustStockClassAuthorizedShares(
	```

</details>



## L-5: Unchecked Return

Function returns a value but it is ignored. Consider checking the return value.

<details><summary>5 Found Instances</summary>


- Found in src/CapTable.sol [Line: 66](chain/src/CapTable.sol#L66)

	```solidity
	        _grantRole(ADMIN_ROLE, admin);
	```

- Found in src/CapTable.sol [Line: 500](chain/src/CapTable.sol#L500)

	```solidity
	        _grantRole(ADMIN_ROLE, addr);
	```

- Found in src/CapTable.sol [Line: 505](chain/src/CapTable.sol#L505)

	```solidity
	        _revokeRole(ADMIN_ROLE, addr);
	```

- Found in src/CapTable.sol [Line: 510](chain/src/CapTable.sol#L510)

	```solidity
	        _grantRole(OPERATOR_ROLE, addr);
	```

- Found in src/CapTable.sol [Line: 515](chain/src/CapTable.sol#L515)

	```solidity
	        _revokeRole(OPERATOR_ROLE, addr);
	```

</details>



## L-6: Unused Error

Consider using or removing the unused error.

<details><summary>3 Found Instances</summary>


- Found in src/CapTable.sol [Line: 46](chain/src/CapTable.sol#L46)

	```solidity
	    error StockClassDoesNotExist(bytes16 stock_class_id);
	```

- Found in src/CapTable.sol [Line: 52](chain/src/CapTable.sol#L52)

	```solidity
	    error InsufficientIssuerSharesAuthorized();
	```

- Found in src/CapTable.sol [Line: 55](chain/src/CapTable.sol#L55)

	```solidity
	    error InsufficientStockClassSharesAuthorized();
	```

</details>



